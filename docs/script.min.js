"use strict";let tasks=[],currentFilter="all",searchQuery="",currentTheme="light",searchVisible=!1;const taskInput=document.getElementById("taskInput"),addBtn=document.getElementById("addBtn"),taskList=document.getElementById("taskList"),taskCount=document.getElementById("taskCount"),clearCompletedBtn=document.getElementById("clearCompleted"),filterButtons=document.querySelectorAll(".filter-btn"),searchInput=document.getElementById("searchInput"),searchToggle=document.getElementById("searchToggle"),themeToggle=document.getElementById("themeToggle"),body=document.body;function loadTasks(){try{const e=localStorage.getItem("tasks");if(e){const t=JSON.parse(e);Array.isArray(t)?(tasks=t,renderTasks()):(console.warn("Los datos guardados no son un array vÃ¡lido. Se inicializarÃ¡ con lista vacÃ­a."),tasks=[],localStorage.removeItem("tasks"))}}catch(e){console.error("Error al cargar tareas del localStorage:",e),tasks=[],localStorage.removeItem("tasks")}}function saveTasks(){localStorage.setItem("tasks",JSON.stringify(tasks))}function createTask(e){return{id:Date.now(),text:e.trim(),completed:!1,createdAt:(new Date).toISOString()}}function addTask(){const e=taskInput.value.trim();if(""===e)return void taskInput.focus();const t=createTask(e);tasks.push(t),taskInput.value="",taskInput.focus(),saveTasks(),renderTasks(),updateStats()}function deleteTask(e){const t=tasks.find(t=>t.id===e);if(!t)return;const s=`Â¿EstÃ¡s seguro de que deseas eliminar la tarea "${t.text}"?`;confirm(s)&&(tasks=tasks.filter(t=>t.id!==e),saveTasks(),renderTasks(),updateStats())}function toggleTask(e){const t=tasks.find(t=>t.id===e);t&&(t.completed=!t.completed,saveTasks(),renderTasks(),updateStats())}function editTask(e,t){const s=tasks.find(t=>t.id===e);s&&""!==t.trim()&&(s.text=t.trim(),saveTasks(),renderTasks())}function getFilteredTasks(){let e=[];switch(currentFilter){case"active":e=tasks.filter(e=>!e.completed);break;case"completed":e=tasks.filter(e=>e.completed);break;default:e=tasks}const t=searchQuery.trim().toLowerCase();return""!==t&&(e=e.filter(e=>e.text.toLowerCase().includes(t))),e}function renderTasks(){const e=getFilteredTasks();0!==e.length?taskList.innerHTML=e.map(e=>`\n            <li class="${e.completed?"task-item completed":"task-item"}" data-id="${e.id}">\n                <input \n                    type="checkbox" \n                    class="task-checkbox" \n                    ${e.completed?"checked":""}\n                    onchange="toggleTask(${e.id})"\n                >\n                <span class="task-text" id="text-${e.id}">${escapeHtml(e.text)}</span>\n                <div class="task-actions">\n                    <button class="edit-btn" onclick="startEdit(${e.id})">Editar</button>\n                    <button class="delete-btn" onclick="deleteTask(${e.id})">Eliminar</button>\n                </div>\n            </li>\n        `).join(""):taskList.innerHTML='<li class="empty-state">No hay tareas para mostrar</li>'}function startEdit(e){const t=tasks.find(t=>t.id===e);if(!t)return;const s=document.getElementById(`text-${e}`),a=t.text;s.innerHTML=`\n        <input \n            type="text" \n            class="task-input-edit" \n            value="${escapeHtml(a)}"\n            id="edit-input-${e}"\n            onblur="finishEdit(${e})"\n            onkeypress="handleEditKeypress(event, ${e})"\n        >\n    `;const n=document.getElementById(`edit-input-${e}`);n.focus(),n.select()}function finishEdit(e){const t=document.getElementById(`edit-input-${e}`);if(t){editTask(e,t.value)}}function handleEditKeypress(e,t){"Enter"===e.key&&finishEdit(t)}function updateStats(){const e=tasks.filter(e=>!e.completed).length,t=tasks.filter(e=>e.completed).length,s=tasks.length;let a=0,n="";switch(currentFilter){case"active":a=e,n=`${a} ${1===a?"tarea pendiente":"tareas pendientes"}`;break;case"completed":a=t,n=`${a} ${1===a?"tarea completada":"tareas completadas"}`;break;default:a=s,n=`${a} ${1===a?"tarea total":"tareas totales"}`}taskCount.textContent=n}function applyTheme(e){currentTheme=e,"dark"===e?(body.classList.add("dark"),themeToggle&&(themeToggle.textContent="â˜€ï¸",themeToggle.title="Modo claro")):(body.classList.remove("dark"),themeToggle&&(themeToggle.textContent="ðŸŒ™",themeToggle.title="Modo oscuro")),localStorage.setItem("theme",e)}function clearCompleted(){tasks=tasks.filter(e=>!e.completed),saveTasks(),renderTasks(),updateStats()}function setFilter(e){currentFilter=e,filterButtons.forEach(t=>{t.dataset.filter===e?t.classList.add("active"):t.classList.remove("active")}),renderTasks(),updateStats()}function escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}addBtn.addEventListener("click",addTask),taskInput.addEventListener("keypress",e=>{"Enter"===e.key&&addTask()}),clearCompletedBtn.addEventListener("click",clearCompleted),filterButtons.forEach(e=>{e.addEventListener("click",()=>{setFilter(e.dataset.filter)})}),searchInput&&searchInput.addEventListener("input",e=>{searchQuery=e.target.value,renderTasks(),updateStats()}),searchToggle&&searchInput&&searchToggle.addEventListener("click",()=>{searchVisible=!searchVisible,searchVisible?(searchInput.classList.remove("hidden"),searchInput.focus()):(searchInput.classList.add("hidden"),searchQuery="",searchInput.value="",renderTasks(),updateStats())}),themeToggle&&themeToggle.addEventListener("click",()=>{applyTheme("dark"===currentTheme?"light":"dark")}),loadTasks(),updateStats();const savedTheme=localStorage.getItem("theme")||"light";applyTheme(savedTheme);