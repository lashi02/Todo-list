let t=[],e="all",a="",n="light",o=!1;const c=document.getElementById("taskInput"),s=document.getElementById("addBtn"),l=document.getElementById("taskList"),r=document.getElementById("taskCount"),i=document.getElementById("clearCompleted"),d=document.querySelectorAll(".filter-btn"),m=document.getElementById("searchInput"),u=document.getElementById("searchToggle"),g=document.getElementById("themeToggle"),k=document.body;function f(){localStorage.setItem("tasks",JSON.stringify(t))}function p(){const e=c.value.trim();if(""===e)return void c.focus();const a=function(t){return{id:Date.now(),text:t.trim(),completed:!1,createdAt:(new Date).toISOString()}}(e);t.push(a),c.value="",c.focus(),f(),v(),h()}function v(){const n=function(){let n=[];switch(e){case"active":n=t.filter(t=>!t.completed);break;case"completed":n=t.filter(t=>t.completed);break;default:n=t}const o=a.trim().toLowerCase();return""!==o&&(n=n.filter(t=>t.text.toLowerCase().includes(o))),n}();0!==n.length?l.innerHTML=n.map(t=>`\n            <li class="${t.completed?"task-item completed":"task-item"}" data-id="${t.id}">\n                <input \n                    type="checkbox" \n                    class="task-checkbox" \n                    ${t.completed?"checked":""}\n                    onchange="toggleTask(${t.id})"\n                >\n                <span class="task-text" id="text-${t.id}">${y(t.text)}</span>\n                <div class="task-actions">\n                    <button class="edit-btn" onclick="startEdit(${t.id})">Editar</button>\n                    <button class="delete-btn" onclick="deleteTask(${t.id})">Eliminar</button>\n                </div>\n            </li>\n        `).join(""):l.innerHTML='<li class="empty-state">No hay tareas para mostrar</li>'}function h(){const a=t.filter(t=>!t.completed).length,n=t.filter(t=>t.completed).length,o=t.length;let c=0,s="";switch(e){case"active":c=a,s=`${c} ${1===c?"tarea pendiente":"tareas pendientes"}`;break;case"completed":c=n,s=`${c} ${1===c?"tarea completada":"tareas completadas"}`;break;default:c=o,s=`${c} ${1===c?"tarea total":"tareas totales"}`}r.textContent=s}function E(t){n=t,"dark"===t?(k.classList.add("dark"),g&&(g.textContent="‚òÄÔ∏è",g.title="Modo claro")):(k.classList.remove("dark"),g&&(g.textContent="üåô",g.title="Modo oscuro")),localStorage.setItem("theme",t)}function y(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}s.addEventListener("click",p),c.addEventListener("keypress",t=>{"Enter"===t.key&&p()}),i.addEventListener("click",function(){t=t.filter(t=>!t.completed),f(),v(),h()}),d.forEach(t=>{t.addEventListener("click",()=>{var a;a=t.dataset.filter,e=a,d.forEach(t=>{t.dataset.filter===a?t.classList.add("active"):t.classList.remove("active")}),v(),h()})}),m&&m.addEventListener("input",t=>{a=t.target.value,v(),h()}),u&&m&&u.addEventListener("click",()=>{o=!o,o?(m.classList.remove("hidden"),m.focus()):(m.classList.add("hidden"),a="",m.value="",v(),h())}),g&&g.addEventListener("click",()=>{E("dark"===n?"light":"dark")}),function(){try{const e=localStorage.getItem("tasks");if(e){const a=JSON.parse(e);Array.isArray(a)?(t=a,v()):(console.warn("Los datos guardados no son un array v√°lido. Se inicializar√° con lista vac√≠a."),t=[],localStorage.removeItem("tasks"))}}catch(e){console.error("Error al cargar tareas del localStorage:",e),t=[],localStorage.removeItem("tasks")}}(),h();E(localStorage.getItem("theme")||"light");